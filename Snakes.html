<!DOCTYPE html>
<html>
<head>
  <title>Advanced Customizable Snake Game</title>
  <meta charset="UTF-8">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #1a1a1a;
      color: white;
      font-family: Arial, sans-serif;
    }

    canvas {
      border: 1px solid white;
      background-color: #4d4d4d;
      display: none;
    }

    #menu {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.85);
      padding: 30px;
      border: 2px solid white;
      border-radius: 10px;
      color: white;
      z-index: 1;
    }

    #menu label {
      margin-top: 15px;
    }

    #menu input[type="number"] {
      margin-left: 10px;
      padding: 5px;
      width: 60px;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: white;
      color: black;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      font-size: 16px;
    }

    button:hover {
      background-color: gray;
    }

    #score {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      color: white;
      display: none;
    }

    #finalScore {
      margin-top: 20px;
      font-size: 18px;
      color: yellow;
    }

    #info {
      display: none;
      background-color: rgba(0, 0, 0, 0.85);
      padding: 20px;
      border-radius: 10px;
      margin-top: 15px;
      color: white;
    }
  </style>
</head>
<body>

  <div id="menu">
    <h2>Snake Game</h2>
    
    <label for="boardSize">
      Board Size (10 - 50):
      <input type="number" id="boardSize" value="25" min="10" max="50">
    </label>
    
    <label for="speed">
      Snake Speed (1 - 10):
      <input type="number" id="speed" value="5" min="1" max="10">
    </label>
    
    <label>
      <input type="checkbox" id="multipleApplesToggle" onclick="document.getElementById('appleCount').disabled = !this.checked;"> Enable Multiple Apples
      <input type="number" id="appleCount" value="1" min="1" max="10" disabled>
    </label>
    
    <label>
      <input type="checkbox" id="powerToggle" onclick="document.getElementById('powerInterval').disabled = !this.checked;"> Enable Power-ups
      <input type="number" id="powerInterval" value="15" min="1" max="100" disabled> (Spawn every X seconds)
    </label>
    
    <button onclick="startGame()">Start Game</button>
    <button onclick="showInfo()">Info</button>
    
    <div id="finalScore"></div>
    <div id="info">
      <h3>Game Info</h3>
      <p><strong>Snake Colors:</strong> Teal or Cyan (No gameplay effect)</p>
      <p><strong>Apple Colors:</strong> Red or Orange (Collect for points)</p>
      <p><strong>Power-ups:</strong></p>
      <ul>
        <li>Speed Up: Magenta</li>
        <li>Speed Down: Magenta</li>
        <li>Score Up: Magenta</li>
      </ul>
      <button onclick="hideInfo()">Close</button>
    </div>
  </div>
  
  <div id="score">Score: 0</div>
  
  <canvas id="game"></canvas>
  
  <script>
    const canvas = document.getElementById('game');
    const context = canvas.getContext('2d');
    const menu = document.getElementById('menu');
    const scoreElement = document.getElementById('score');
    const finalScoreElement = document.getElementById('finalScore');
    const infoElement = document.getElementById('info');

    let grid = 16;
    let count = 0;
    let snakeSpeed = 5;
    let snakeColor = '';
    let score = 0;
    let gameInterval;
    let powerIntervalId;
    let isGameRunning = false;

    let snake, apples = [], powers = [];

    const POWER_TYPES = {
      SPEED_UP: 0,
      SPEED_DOWN: 1,
      SCORE_UP: 2
    };

    function initGame(boardSize, appleCount) {
      canvas.width = boardSize * grid;
      canvas.height = boardSize * grid;

      snake = {
        x: Math.floor(boardSize / 2) * grid,
        y: Math.floor(boardSize / 2) * grid,
        dx: grid,
        dy: 0,
        cells: [],
        maxCells: 4
      };
      
      apples = [];
      for (let i = 0; i < appleCount; i++) {
        spawnApple();
      }
      
      powers = [];
      snakeColor = getRandomSnakeColor();
      score = 0;
      updateScore();
    }

    function startGame() {
      if (isGameRunning) return;

      const boardSize = parseInt(document.getElementById('boardSize').value);
      const speedInput = parseInt(document.getElementById('speed').value);
      const multipleApplesToggle = document.getElementById('multipleApplesToggle').checked;
      const appleCount = multipleApplesToggle ? parseInt(document.getElementById('appleCount').value) : 1;
      const powerToggle = document.getElementById('powerToggle').checked;
      const powerInterval = parseInt(document.getElementById('powerInterval').value) * 1000;

      snakeSpeed = 11 - speedInput;
      grid = Math.floor(400 / boardSize);
      if (400 % boardSize !== 0) {
        alert('Board size must evenly divide 400 for proper grid alignment.');
        return;
      }

      initGame(boardSize, appleCount);
      menu.style.display = 'none';
      canvas.style.display = 'block';
      scoreElement.style.display = 'block';
      
      gameInterval = setInterval(loop, snakeSpeed * 100);
      
      if (powerToggle) {
        powerIntervalId = setInterval(spawnPower, powerInterval);
      }
      
      isGameRunning = true;
    }

    function spawnApple() {
      let newApple;
      do {
        newApple = {
          x: getRandomInt(0, canvas.width / grid) * grid,
          y: getRandomInt(0, canvas.height / grid) * grid,
          color: getRandomAppleColor()
        };
      } while (isOccupied(newApple.x, newApple.y));
      apples.push(newApple);
    }

    function spawnPower() {
      let newPower;
      const type = getRandomPowerType();
      do {
        newPower = {
          x: getRandomInt(0, canvas.width / grid) * grid,
          y: getRandomInt(0, canvas.height / grid) * grid,
          color: 'magenta', // Fixed color for power-ups
          type: type
        };
      } while (isOccupied(newPower.x, newPower.y));
      powers.push(newPower);
    }

    function isOccupied(x, y) {
      if (snake.cells.some(cell => cell.x === x && cell.y === y)) return true;
      if (apples.some(apple => apple.x === x && apple.y === y)) return true;
      return false;
    }

    function getRandomAppleColor() {
      const appleColors = ['red', 'orange'];
      return appleColors[Math.floor(Math.random() * appleColors.length)];
    }

    function getRandomSnakeColor() {
      const snakeColors = ['teal', 'cyan'];
      return snakeColors[Math.floor(Math.random() * snakeColors.length)];
    }

    function getRandomPowerType() {
      return Math.floor(Math.random() * 3); // 0, 1, or 2
    }

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    }

    document.addEventListener('keydown', (e) => {
      switch (e.key) {
        case 'ArrowUp':
        case 'w':
          if (snake.dy === 0) {
            snake.dx = 0;
            snake.dy = -grid;
          }
          break;
        case 'ArrowDown':
        case 's':
          if (snake.dy === 0) {
            snake.dx = 0;
            snake.dy = grid;
          }
          break;
        case 'ArrowLeft':
        case 'a':
          if (snake.dx === 0) {
            snake.dx = -grid;
            snake.dy = 0;
          }
          break;
        case 'ArrowRight':
        case 'd':
          if (snake.dx === 0) {
            snake.dx = grid;
            snake.dy = 0;
          }
          break;
      }
    });

    function loop() {
      if (++count < 1) {
        return;
      }
      count = 0;

      context.clearRect(0, 0, canvas.width, canvas.height);

      snake.x += snake.dx;
      snake.y += snake.dy;

      if (snake.x < 0) snake.x = canvas.width - grid;
      else if (snake.x >= canvas.width) snake.x = 0;
      if (snake.y < 0) snake.y = canvas.height - grid;
      else if (snake.y >= canvas.height) snake.y = 0;

      apples.forEach((apple, index) => {
        if (snake.x === apple.x && snake.y === apple.y) {
          score += 10;
          updateScore();
          snake.maxCells++;
          apples.splice(index, 1);
          spawnApple();
        }
      });

      powers.forEach((power, index) => {
        if (snake.x === power.x && snake.y === power.y) {
          applyPower(power.type);
          powers.splice(index, 1);
        }
      });

      snake.cells.unshift({ x: snake.x, y: snake.y });

      if (snake.cells.length > snake.maxCells) {
        snake.cells.pop();
      }

      for (let i = 1; i < snake.cells.length; i++) {
        if (snake.cells[i].x === snake.x && snake.cells[i].y === snake.y) {
          endGame();
        }
      }

      context.fillStyle = snakeColor;
      snake.cells.forEach((cell) => {
        context.fillRect(cell.x, cell.y, grid - 1, grid - 1);
      });

      apples.forEach(apple => {
        context.fillStyle = apple.color;
        context.fillRect(apple.x, apple.y, grid - 1, grid - 1);
      });

      powers.forEach(power => {
        context.fillStyle = power.color; // Fixed to magenta
        context.fillRect(power.x, power.y, grid - 1, grid - 1);
        context.fillStyle = 'white'; // Draw type number
        context.font = '12px Arial';
        context.fillText(power.type + 1, power.x + 4, power.y + 12); // Display power type
      });
    }

    function applyPower(type) {
      switch (type) {
        case POWER_TYPES.SPEED_UP:
          snakeSpeed = Math.max(1, snakeSpeed - 1);
          clearInterval(gameInterval);
          gameInterval = setInterval(loop, snakeSpeed * 100);
          break;
        case POWER_TYPES.SPEED_DOWN:
          snakeSpeed = Math.min(10, snakeSpeed + 1);
          clearInterval(gameInterval);
          gameInterval = setInterval(loop, snakeSpeed * 100);
          break;
        case POWER_TYPES.SCORE_UP:
          score += 50;
          updateScore();
          break;
      }
    }

    function updateScore() {
      scoreElement.textContent = `Score: ${score}`;
    }

    function endGame() {
      clearInterval(gameInterval);
      clearInterval(powerIntervalId);
      isGameRunning = false;
      canvas.style.display = 'none';
      scoreElement.style.display = 'none';
      finalScoreElement.textContent = `Final Score: ${score}`;
      finalScoreElement.style.display = 'block';
      menu.style.display = 'flex';
    }

    function showInfo() {
      infoElement.style.display = 'block';
    }

    function hideInfo() {
      infoElement.style.display = 'none';
    }
  </script>
</body>
</html>
